---
title: "SCFA Analysis: Abbott Carbohydrate Obesity Project"
author: "Patrick Seed, MD, PhD"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    code_folding: show
    theme: united
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, 
                      fig.width = 12, fig.height = 8, dpi = 300)
```

# Introduction

## Project Purpose and Significance

Obesity continues to increase as a public health emergency, with the origins of most adult obesity being in childhood. Effective clinical approaches are urgently needed to prevent or reverse childhood obesity. The gut-associated microbiome is an established central factor in energy harvest, hepatic function, insulin sensitivity, and adipose tissue homeostasis, making it a critical target for obesity intervention strategies.

This project represents a collaborative effort between Lurie Children's Hospital and Abbott Nutrition to investigate interpersonal variation in energetics and short-chain fatty acid (SCFA) production of obesity-associated gut microbiota in response to slow and fast digestible carbohydrates. The work builds upon foundational research demonstrating that carbohydrate quality, rather than quantity alone, plays a crucial role in metabolic health.

## Scientific Foundation and Motivation

The project was motivated by compelling evidence from the Frontiers in Nutrition paper by Wang et al. (2022) that demonstrated the therapeutic potential of slowly digestible carbohydrates (SDC) in metabolic syndrome and obesity management. This seminal work showed that SDC displays beneficial effects on reducing glucose excursions in healthy, insulin-resistant, and type 2 diabetic individuals, inducing a slow and prolonged glucose release that results in reduced postprandial glycemic responses and extended glycemic index values.

In type 2 diabetic patients, SDC-rich diets (60g/day) reduced glycemic variability parameters by 17-23%, with these parameters correlating with HbA1c, suggesting potential for long-term glycemic improvement. The Frontiers paper also demonstrated that foods with the highest SDC content (23.9-27.5 g/100g) induce the lowest glycemic responses with the lowest incremental AUC of glucose and insulin concentration.

## Comparative Evidence from Murine Models

In comparison to fast digestible carbohydrate (FDC) sources, the Abbott group has shown in murine models of obesity that nutrition with slow digestible carbohydrates (SDC) reverses obesity-associated phenotypes, including elevated body mass, insulin resistance, and systemic inflammation. However, the interpersonal differences in SDC responses by the childhood-associated human microbiota may not be fully predicted in murine obesity models.

## Interpersonal Variation in Human Microbiota

Lurie investigators and colleagues have shown interpersonal variation in the production of short-chain fatty acids (SCFA) by the human gut microbiome from adolescents with obesity in response to ex vivo prebiotic exposure, suggesting that complex carbohydrate utilization by the microbiota varies between individuals and thus may affect who responds to SDC and other nutritional approaches to obesity.

Understanding the variation in the compositional and metabolic responses of the childhood-associated microbiota may inform future obesity-treatment trials and precision approaches to obesity therapy.

## Project Objectives

The main objectives of this project are to:

1. **Measure variation in responses** between different human gut-associated microbiome communities to FDC and SDC
2. **Identify childhood-associated organisms** with facile utilization of SDC
3. **Test interindividual variation** of short-chain fatty acid production among fecal microbiota samples to slow and fast digestible carbohydrates
4. **Measure energy harvest differences** between human obesity-associated fecal microbiota
5. **Isolate SDC bacterial utilizers** using single cell isolation techniques towards the future goal of creating obesity treatment synbiotic combinations

## Clinical Impact

Understanding the interpersonal differences in SDC utilization by the childhood-associated human microbiota may inform future obesity-treatment trials through the identification of likely responders and, subsequently, precision approaches to obesity therapy. This precision nutrition approach could revolutionize childhood obesity treatment by enabling personalized dietary interventions based on individual microbiome composition and metabolic capacity.

## Analysis Overview

This document presents the analysis of short-chain fatty acids (SCFAs) in the Abbott carbohydrate obesity project. The analysis examines how SCFA analytes change between experimental groups, carbohydrate types, and time points, with particular focus on identifying interpersonal variation in metabolic responses to different carbohydrate sources.

# Methods

## Metabolomics Overview

The fecal metabolome was analyzed using targeted metabolomics approaches. The DFI Host-Microbe Metabolomics Facility (DFI-HMMF) analyzed fecal material using validated methods and analysis pipelines. All compounds were validated through retention time and fragmentation comparison to standards and available databases.

## SCFA Analysis using PFBBr Panel

Short chain fatty acids were analyzed using Gas chromatography-mass spectrometry (GC-MS) following derivatization with pentafluorobenzyl bromide (PFBBr). SCFAs (acetate, butyrate, propionate) were quantitatively analyzed following PFB derivatization and detection by negative collision induced gas chromatography-mass spectrometry ((-)-CI-GC-MS, Agilent 8890). Additional compounds including 5-aminovalerate and succinate were also quantified.

### Detailed SCFA Analysis Protocol

The following section outlines the specific protocol used for SCFA derivatization and GC-MS analysis.

Short chain fatty acids were derivatized as described by Haak et al. with modifications. The metabolite extract (100 µL) was added to 100 µL of 100 mM borate buffer (pH 10), 400 µL of 100 mM pentafluorobenzyl bromide in Acetonitrile, and 400 µL of n-hexane in a capped mass spec autosampler vial. Samples were heated to 65°C for 1 hour while shaking at 1300 rpm. After cooling, samples were centrifuged at 4°C, 2000 x g for 5 min, allowing phase separation. The hexanes phase was transferred and analyzed.

Samples were analyzed using a GC-MS (Agilent 7890A GC system, Agilent 5975C MS detector) operating in negative chemical ionization mode, using a HP-5MSUI column (30 m x 0.25 mm, 0.25 µm), methane as the reagent gas and 1 µL split injection (1:10 split ratio). A 10-point calibration curve was prepared with acetate (100 mM), propionate (25 mM), butyrate (12.5 mM), and succinate (50 mM), with 9 subsequent 2x serial dilutions.

### Sample Extraction

This section describes the procedure for extracting metabolites from the fecal samples prior to analysis.

Extraction solvent (80% methanol spiked with internal standards and stored at -80°C) was added at a ratio of 100 mg of material/mL of extraction solvent. Samples were homogenized at 4°C on a Bead Mill 24 Homogenizer, set at 1.6 m/s with 6 thirty-second cycles, 5 seconds off per cycle. Samples were then centrifuged at -10°C, 20,000 x g for 15 min and the supernatant was used for analysis.

# Data Analysis

```{r load-libraries}
library(tidyverse)
library(readxl)
library(janitor)
library(data.table)
library(ggpubr)
library(rstatix)
library(viridis)
library(RColorBrewer)
library(lme4)
library(lmerTest)
library(kableExtra)

# Function to convert column names to publication-ready headers
make_publication_headers <- function(col_names) {
  headers <- col_names %>%
    str_replace_all("_", " ") %>%
    str_to_title() %>%
    str_replace("Group", "Group") %>%
    str_replace("Analyte", "Analyte") %>%
    str_replace("Concentration", "Concentration (μM)") %>%
    str_replace("Mean", "Mean") %>%
    str_replace("Sd", "SD") %>%
    str_replace("Sem", "SEM") %>%
    str_replace("N", "n") %>%
    str_replace("Median", "Median") %>%
    str_replace("Q25", "Q25") %>%
    str_replace("Q75", "Q75") %>%
    str_replace("P Value", "P-value") %>%
    str_replace("P Adj", "Adjusted P-value") %>%
    str_replace("Significance", "Significance") %>%
    str_replace("T Stat", "t-statistic") %>%
    str_replace("Df", "df") %>%
    str_replace("Change 0 To 48", "Change (0-48h)") %>%
    str_replace("Mean Change", "Mean Change") %>%
    str_replace("Sd Change", "SD Change") %>%
    str_replace("Sem Change", "SEM Change") %>%
    str_replace("N Observations", "n Observations") %>%
    str_replace("N Subjects", "n Subjects") %>%
    str_replace("Mean Subject Means", "Mean Subject Means") %>%
    str_replace("Sd Subject Means", "SD Subject Means") %>%
    str_replace("Sem Subjects", "SEM Subjects")
  
  return(headers)
}

# Function to create publication-ready labels for plots
make_publication_labels <- function(data, column) {
  labels <- data %>%
    pull({{column}}) %>%
    unique() %>%
    str_replace_all("_", " ") %>%
    str_to_title() %>%
    str_replace("Rapid Digestible", "Rapid Digestible") %>%
    str_replace("Slow Digestible", "Slow Digestible") %>%
    str_replace("No Carbohydrate", "No Carbohydrate") %>%
    str_replace("Case", "Case") %>%
    str_replace("Control", "Control")
  
  return(labels)
}

# Publication-ready theme for plots
pub_theme <- theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.title = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 10),
    strip.text = element_text(size = 11, face = "bold"),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5)
  )
```

## Load Metadata

```{r load-metadata}
# Read in first metadata file
map <- read_excel("metadata/SEED LAB HMM Submission Sheet 202405.xlsx", skip = 9) %>% 
  clean_names()

# Replace column names with cleaned names
colnames(map) <- c("sampleid", "group", "bile_acids_panel", "pfbbr_scfa_panel", 
                   "tryp_indole_panel", "tms_panel_1", "tms_panel_2", "tms_panel_3", 
                   "untargeted_panel", "custom_targeted_panel", 
                   "low_abundant_metabolite_panel", "sample_origin", "sample_type", 
                   "mouse_number", "services_requested_per_sample", "mouse_strain", 
                   "mouse_flora", "volume_ul", "sample_weight_mg", "experiment_treatment")

# Clean metadata
map <- map %>% 
  filter(!is.na(sampleid)) %>%
  filter(sampleid != "") %>%
  slice(-(1:3))
```

```{r parse-sample-names}
# Extract information from sample names
map <- map %>%
  mutate(
    # Extract subject ID (digits only, stripping off letters at the end)
    subject = str_extract(sampleid, "^[0-9]+"),
    
    # Extract the part between spaces (e.g., "r1", "s2", "nc")
    carb_repeat = str_extract(sampleid, "(?<= )[rs]\\d|nc(?= )"),
    
    # Create carbohydrate_type column
    carbohydrate_type = case_when(
      str_detect(carb_repeat, "^r") ~ "rapid_digestible",
      str_detect(carb_repeat, "^s") ~ "slow_digestible", 
      str_detect(carb_repeat, "^nc") ~ "no_carbohydrate",
      TRUE ~ NA_character_
    ),
    
    # Extract technical repeat number (handle "nc" case where there's no number)
    technical_repeat = case_when(
      str_detect(carb_repeat, "^nc") ~ 1L,  # nc gets repeat 1
      TRUE ~ as.integer(str_extract(carb_repeat, "\\d+"))
    ),
    
    # Extract timepoint (after second space, before "h")
    timepoint_hr = as.integer(str_extract(sampleid, "(?<= )\\d+(?=h$)"))
  ) %>%
  # Remove the temporary carb_repeat column and select relevant columns
  select(-carb_repeat) %>%
  select(sampleid, group, subject, carbohydrate_type, technical_repeat, timepoint_hr)
```

```{r load-additional-metadata}
# Load second metadata file
map2 <- read_excel("metadata/PS2720_xtra_samples_HMM Submission Sheet.xlsx", skip = 9) %>% 
  clean_names()

# Apply same processing as first file
colnames(map2) <- c("sampleid", "group", "bile_acids_panel", "pfbbr_scfa_panel", 
                    "tryp_indole_panel", "tms_panel_1", "tms_panel_2", "tms_panel_3", 
                    "untargeted_panel", "custom_targeted_panel", 
                    "low_abundant_metabolite_panel", "sample_origin", "sample_type", 
                    "mouse_number", "services_requested_per_sample", "mouse_strain", 
                    "mouse_flora", "volume_ul", "sample_weight_mg", "experiment_treatment")

map2 <- map2 %>% 
  filter(!is.na(sampleid)) %>%
  filter(sampleid != "") %>%
  slice(-(1:3)) %>%
  mutate(
    # Extract subject ID (digits only, stripping off letters at the end)
    subject = str_extract(sampleid, "^[0-9]+"),
    
    carb_repeat = str_extract(sampleid, "(?<= )[rs]\\d|nc(?= )"),
    carbohydrate_type = case_when(
      str_detect(carb_repeat, "^r") ~ "rapid_digestible",
      str_detect(carb_repeat, "^s") ~ "slow_digestible", 
      str_detect(carb_repeat, "^nc") ~ "no_carbohydrate",
      TRUE ~ NA_character_
    ),
    technical_repeat = case_when(
      str_detect(carb_repeat, "^nc") ~ 1L,
      TRUE ~ as.integer(str_extract(carb_repeat, "\\d+"))
    ),
    timepoint_hr = as.integer(str_extract(sampleid, "(?<= )\\d+(?=h$)"))
  ) %>%
  select(-carb_repeat) %>%
  select(sampleid, group, subject, carbohydrate_type, technical_repeat, timepoint_hr)

# Combine metadata files
map <- bind_rows(map, map2)

# Make group names lowercase for consistency and handle NA values
map <- map %>%
  mutate(group = tolower(group)) %>%
  filter(!is.na(group))  # Remove rows with NA group values
```

## Load SCFA Data

```{r load-data}
# Read in SCFA quantification data
data <- fread("data/removed_qcs_quant_results_20250722_PFBBr_PS2720_20250731.csv")

# Join metadata with SCFA data
sample_data <- left_join(map, data, by = "sampleid")

# Ensure group names are lowercase and remove NA group values
sample_data <- sample_data %>%
  mutate(group = tolower(group)) %>%
  filter(!is.na(group))  # Remove rows with NA group values

# Create publication-ready labels for plotting
sample_data <- sample_data %>%
  mutate(
    group_label = str_to_title(group),
    carbohydrate_type_label = str_replace_all(carbohydrate_type, "_", " ") %>%
      str_to_title() %>%
      str_replace("Rapid Digestible", "Rapid Digestible") %>%
      str_replace("Slow Digestible", "Slow Digestible") %>%
      str_replace("No Carbohydrate", "No Carbohydrate")
  )

# Display data structure
cat("Dataset dimensions:", dim(sample_data), "\n")
cat("Sample groups:", unique(sample_data$group_label), "\n")
cat("Carbohydrate types:", unique(sample_data$carbohydrate_type_label), "\n")
cat("Time points:", unique(sample_data$timepoint_hr), "\n")
```

# Summary Statistics

```{r define-analytes}
# Define SCFA analytes (excluding non-SCFA compounds)
scfa_analytes <- c("acetate", "butyrate", "propionate", "5aminovalerate", "succinate")

# Convert data to long format and average technical replicates
sample_data_long <- sample_data %>%
  pivot_longer(cols = all_of(scfa_analytes), 
               names_to = "analyte", 
               values_to = "concentration") %>%
  filter(!is.na(concentration)) %>%
  # Average technical replicates FIRST before any statistical analysis
  group_by(subject, group, carbohydrate_type, timepoint_hr, analyte, group_label, carbohydrate_type_label) %>%
  summarise(concentration = mean(concentration, na.rm = TRUE), .groups = "drop")

cat("Total observations after averaging technical replicates:", nrow(sample_data_long), "\n")
```

## Summary by Group

```{r summary-by-group}
summary_by_group <- sample_data_long %>%
  group_by(group_label, analyte) %>%
  summarise(
    n = n(),
    mean = mean(concentration, na.rm = TRUE),
    median = median(concentration, na.rm = TRUE),
    sd = sd(concentration, na.rm = TRUE),
    sem = sd / sqrt(n),
    q25 = quantile(concentration, 0.25, na.rm = TRUE),
    q75 = quantile(concentration, 0.75, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  rename(Group = group_label) %>%
  # Order so control and case are adjacent for each analyte
  arrange(analyte, Group)

# Create publication-ready column headers
col_names <- colnames(summary_by_group)
pub_headers <- make_publication_headers(col_names)
names(summary_by_group) <- pub_headers

knitr::kable(summary_by_group, digits = 3, 
             caption = "Summary Statistics by Experimental Group") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Summary by Carbohydrate Type

```{r summary-by-carb}
summary_by_carb <- sample_data_long %>%
  group_by(carbohydrate_type_label, analyte) %>%
  summarise(
    n = n(),
    mean = mean(concentration, na.rm = TRUE),
    median = median(concentration, na.rm = TRUE),
    sd = sd(concentration, na.rm = TRUE),
    sem = sd / sqrt(n),
    q25 = quantile(concentration, 0.25, na.rm = TRUE),
    q75 = quantile(concentration, 0.75, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  rename(`Carbohydrate Type` = carbohydrate_type_label) %>%
  # Order so the 3 carbohydrate types are in series with each analyte
  arrange(analyte, `Carbohydrate Type`)

# Create publication-ready column headers
col_names <- colnames(summary_by_carb)
pub_headers <- make_publication_headers(col_names)
names(summary_by_carb) <- pub_headers

knitr::kable(summary_by_carb, digits = 3, 
             caption = "Summary Statistics by Carbohydrate Type") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Summary by Time Point

```{r summary-by-time}
summary_by_time <- sample_data_long %>%
  group_by(timepoint_hr, analyte) %>%
  summarise(
    n = n(),
    mean = mean(concentration, na.rm = TRUE),
    median = median(concentration, na.rm = TRUE),
    sd = sd(concentration, na.rm = TRUE),
    sem = sd / sqrt(n),
    q25 = quantile(concentration, 0.25, na.rm = TRUE),
    q75 = quantile(concentration, 0.75, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  rename(`Time (hours)` = timepoint_hr) %>%
  # Order so that 0h and 48h are adjacent per analyte
  arrange(analyte, `Time (hours)`)

# Create publication-ready column headers
col_names <- colnames(summary_by_time)
pub_headers <- make_publication_headers(col_names)
names(summary_by_time) <- pub_headers

knitr::kable(summary_by_time, digits = 3, 
             caption = "Summary Statistics by Time Point") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Combined Summary Statistics

```{r summary-combined}
summary_combined <- sample_data_long %>%
  group_by(group_label, carbohydrate_type_label, timepoint_hr, analyte) %>%
  summarise(
    n = n(),
    mean = mean(concentration, na.rm = TRUE),
    median = median(concentration, na.rm = TRUE),
    sd = sd(concentration, na.rm = TRUE),
    sem = sd / sqrt(n),
    q25 = quantile(concentration, 0.25, na.rm = TRUE),
    q75 = quantile(concentration, 0.75, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  rename(Group = group_label, `Carbohydrate Type` = carbohydrate_type_label, `Time (hours)` = timepoint_hr)

# Create publication-ready column headers
col_names <- colnames(summary_combined)
pub_headers <- make_publication_headers(col_names)
names(summary_combined) <- pub_headers

# Create results directory and save combined summary
dir.create("results", showWarnings = FALSE)
write.csv(summary_combined, "results/combined_summary_statistics.csv", row.names = FALSE)

cat("Combined summary table contains", nrow(summary_combined), "condition combinations\n")
cat("Combined summary saved to results/combined_summary_statistics.csv\n")
```

# Statistical Analysis

```{r statistical-analysis}
# Prepare data with proper factor levels for statistical testing
sample_data_long <- sample_data_long %>%
  mutate(
    group = factor(group, levels = c("control", "case")),
    carbohydrate_type = factor(carbohydrate_type, 
                              levels = c("no_carbohydrate", "rapid_digestible", "slow_digestible")),
    timepoint_hr = factor(timepoint_hr),
    subject = factor(subject)  # Add subject as factor for random effects
  )

# Statistical tests by group (t-tests)
group_stats <- sample_data_long %>%
  group_by(analyte) %>%
  t_test(concentration ~ group) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance() %>%
  as.data.frame() %>%
  rename(Analyte = analyte, `P-value` = p, `Adjusted P-value` = p.adj, 
         Significance = p.adj.signif)

# Statistical tests by carbohydrate type (ANOVA with post-hoc)
carb_stats <- sample_data_long %>%
  group_by(analyte) %>%
  anova_test(concentration ~ carbohydrate_type) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance() %>%
  as.data.frame() %>%
  rename(Analyte = analyte, `P-value` = p, `Adjusted P-value` = p.adj, 
         Significance = p.adj.signif)

# Post-hoc comparisons for carbohydrate type (vs no_carbohydrate)
carb_posthoc <- sample_data_long %>%
  group_by(analyte) %>%
  pairwise_t_test(concentration ~ carbohydrate_type, 
                  ref.group = "no_carbohydrate") %>%
  adjust_pvalue(method = "BH") %>%
  add_significance() %>%
  as.data.frame() %>%
  rename(Analyte = analyte, `P-value` = p, `Adjusted P-value` = p.adj, 
         Significance = p.adj.signif)

# Three-way ANOVA: Group x Carbohydrate x Time interaction
interaction_stats <- sample_data_long %>%
  group_by(analyte) %>%
  anova_test(concentration ~ group * carbohydrate_type * timepoint_hr) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance()

# Mixed-effects models accounting for subject as random effect
mixed_effects_results <- list()

for (analyte_name in scfa_analytes) {
  analyte_data <- sample_data_long %>% filter(analyte == analyte_name)
  
  # Full model with all interactions and subject as random intercept
  full_model <- lmer(concentration ~ group * carbohydrate_type * timepoint_hr + 
                     (1 | subject), 
                     data = analyte_data, 
                     REML = FALSE)
  
  # Model without three-way interaction
  no_three_way <- lmer(concentration ~ group + carbohydrate_type + timepoint_hr +
                       group:carbohydrate_type + group:timepoint_hr + 
                       carbohydrate_type:timepoint_hr + (1 | subject), 
                       data = analyte_data, 
                       REML = FALSE)
  
  # Model with only main effects
  main_effects <- lmer(concentration ~ group + carbohydrate_type + timepoint_hr + 
                       (1 | subject), 
                       data = analyte_data, 
                       REML = FALSE)
  
  # Store results
  mixed_effects_results[[analyte_name]] <- list(
    full_model = full_model,
    no_three_way = no_three_way,
    main_effects = main_effects,
    anova_full = anova(full_model),
    summary_full = summary(full_model)
  )
}

# Subject-level summary statistics
subject_summary <- sample_data_long %>%
  group_by(subject, group, analyte) %>%
  summarise(
    mean_conc = mean(concentration, na.rm = TRUE),
    n_observations = n(),
    .groups = "drop"
  ) %>%
  group_by(group, analyte) %>%
  summarise(
    n_subjects = n(),
    mean_subject_means = mean(mean_conc, na.rm = TRUE),
    sd_subject_means = sd(mean_conc, na.rm = TRUE),
    sem_subjects = sd_subject_means / sqrt(n_subjects),
    .groups = "drop"
  ) %>%
  rename(Group = group, Analyte = analyte, `n Subjects` = n_subjects, 
         `Mean Subject Means` = mean_subject_means, `SD Subject Means` = sd_subject_means, 
         `SEM Subjects` = sem_subjects)

# Within-subject changes (baseline to 48h)
within_subject_changes <- sample_data_long %>%
  filter(timepoint_hr %in% c("0", "48")) %>%
  mutate(timepoint_hr = as.character(timepoint_hr)) %>%  # Convert back to character for pivot
  select(subject, group, carbohydrate_type, timepoint_hr, analyte, concentration) %>%
  pivot_wider(names_from = timepoint_hr, 
              values_from = concentration, 
              names_prefix = "time_") %>%
  mutate(change_0_to_48 = time_48 - time_0) %>%
  filter(!is.na(change_0_to_48))

# Statistical tests for within-subject changes
within_subject_stats <- within_subject_changes %>%
  group_by(group, carbohydrate_type, analyte) %>%
  summarise(
    n = n(),
    mean_change = mean(change_0_to_48, na.rm = TRUE),
    sd_change = sd(change_0_to_48, na.rm = TRUE),
    sem_change = sd_change / sqrt(n),
    t_stat = mean_change / sem_change,
    p_value = 2 * pt(-abs(t_stat), df = n - 1),  # two-tailed t-test
    .groups = "drop"
  ) %>%
  group_by(analyte) %>%
  mutate(p_adj = p.adjust(p_value, method = "BH")) %>%
  mutate(significance = case_when(
    p_adj < 0.001 ~ "***",
    p_adj < 0.01 ~ "**", 
    p_adj < 0.05 ~ "*",
    TRUE ~ "ns"
  )) %>%
  rename(Group = group, `Carbohydrate Type` = carbohydrate_type, Analyte = analyte, 
         `Mean Change` = mean_change, `SD Change` = sd_change, `SEM Change` = sem_change,
         `t-statistic` = t_stat, `P-value` = p_value, `Adjusted P-value` = p_adj, 
         Significance = significance)

# Case-only temporal analysis (0h vs 48h)
case_only_changes <- sample_data_long %>%
  filter(group == "case", timepoint_hr %in% c("0", "48")) %>%
  mutate(timepoint_hr = as.character(timepoint_hr)) %>%
  pivot_wider(names_from = timepoint_hr, 
              values_from = concentration, 
              names_prefix = "time_") %>%
  mutate(change_0_to_48 = time_48 - time_0) %>%
  filter(!is.na(change_0_to_48))

# Statistical tests for case-only temporal changes
case_only_stats <- case_only_changes %>%
  group_by(carbohydrate_type, analyte) %>%
  summarise(
    n = n(),
    mean_change = mean(change_0_to_48, na.rm = TRUE),
    sd_change = sd(change_0_to_48, na.rm = TRUE),
    sem_change = sd_change / sqrt(n),
    t_stat = mean_change / sem_change,
    p_value = 2 * pt(-abs(t_stat), df = n - 1),  # two-tailed t-test
    .groups = "drop"
  ) %>%
  group_by(analyte) %>%
  mutate(p_adj = p.adjust(p_value, method = "BH")) %>%
  mutate(significance = case_when(
    p_adj < 0.001 ~ "***",
    p_adj < 0.01 ~ "**", 
    p_adj < 0.05 ~ "*",
    TRUE ~ "ns"
  )) %>%
  rename(`Carbohydrate Type` = carbohydrate_type, Analyte = analyte, 
         `Mean Change` = mean_change, `SD Change` = sd_change, `SEM Change` = sem_change,
         `t-statistic` = t_stat, `P-value` = p_value, `Adjusted P-value` = p_adj, 
         Significance = significance)

# Paired t-tests for case-only changes by analyte (pooled across carb types)
case_only_pooled_stats <- case_only_changes %>%
  group_by(analyte) %>%
  summarise(
    n = n(),
    mean_change = mean(change_0_to_48, na.rm = TRUE),
    sd_change = sd(change_0_to_48, na.rm = TRUE),
    sem_change = sd_change / sqrt(n),
    t_stat = mean_change / sem_change,
    p_value = 2 * pt(-abs(t_stat), df = n - 1),
    .groups = "drop"
  ) %>%
  mutate(p_adj = p.adjust(p_value, method = "BH")) %>%
  mutate(significance = case_when(
    p_adj < 0.001 ~ "***",
    p_adj < 0.01 ~ "**", 
    p_adj < 0.05 ~ "*",
    TRUE ~ "ns"
  )) %>%
  rename(Analyte = analyte, `Mean Change` = mean_change, `SD Change` = sd_change, 
         `SEM Change` = sem_change, `t-statistic` = t_stat, `P-value` = p_value, 
         `Adjusted P-value` = p_adj, Significance = significance)

# Mixed-effects models for case-only temporal analysis
case_only_mixed_effects <- list()

# Filter data to case group only
case_only_data <- sample_data_long %>%
  filter(group == "case") %>%
  mutate(
    timepoint_hr = factor(timepoint_hr),
    subject = factor(subject),
    carbohydrate_type = factor(carbohydrate_type, 
                              levels = c("no_carbohydrate", "rapid_digestible", "slow_digestible"))
  )

for (analyte_name in scfa_analytes) {
  case_analyte_data <- case_only_data %>% filter(analyte == analyte_name)
  
  # Model with time and carbohydrate effects, subject as random intercept
  time_carb_model <- lmer(concentration ~ timepoint_hr * carbohydrate_type + 
                          (1 | subject), 
                          data = case_analyte_data, 
                          REML = FALSE)
  
  # Model with time effect only, subject as random intercept
  time_only_model <- lmer(concentration ~ timepoint_hr + (1 | subject), 
                          data = case_analyte_data, 
                          REML = FALSE)
  
  # Model with carbohydrate effect only, subject as random intercept
  carb_only_model <- lmer(concentration ~ carbohydrate_type + (1 | subject), 
                          data = case_analyte_data, 
                          REML = FALSE)
  
  # Null model (intercept + random effect only)
  null_model <- lmer(concentration ~ 1 + (1 | subject), 
                     data = case_analyte_data, 
                     REML = FALSE)
  
  # Store results
  case_only_mixed_effects[[analyte_name]] <- list(
    time_carb_model = time_carb_model,
    time_only_model = time_only_model,
    carb_only_model = carb_only_model,
    null_model = null_model,
    anova_time_carb = anova(time_carb_model),
    summary_time_carb = summary(time_carb_model),
    # Model comparisons
    time_vs_null = anova(null_model, time_only_model),
    carb_vs_null = anova(null_model, carb_only_model),
    interaction_vs_main = anova(time_only_model, time_carb_model)
  )
}

# Save subject-level analyses to CSV files
write.csv(subject_summary, "results/subject_level_summary.csv", row.names = FALSE)
write.csv(within_subject_stats, "results/within_subject_changes.csv", row.names = FALSE)
write.csv(case_only_stats, "results/case_only_temporal_changes.csv", row.names = FALSE)
write.csv(case_only_pooled_stats, "results/case_only_pooled_temporal_changes.csv", row.names = FALSE)

cat("Subject-level and case-only analyses saved to results/ directory\n")
```

## Statistical Results

We performed several statistical tests to compare SCFA concentrations across different experimental conditions. The following tables summarize the results of these comparisons, including t-tests for group differences and ANOVA for carbohydrate effects.

### Group Comparisons (Control vs Case)

This table presents the results of t-tests comparing SCFA concentrations between the control and case groups.

```{r group-stats-table}
knitr::kable(group_stats, digits = 4, 
             caption = "Group Comparisons with Benjamini-Hochberg Correction") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Carbohydrate Type Comparisons

This table shows the results of ANOVA tests examining the effect of different carbohydrate types on SCFA concentrations.

```{r carb-stats-table}
knitr::kable(carb_stats, digits = 4, 
             caption = "ANOVA Results for Carbohydrate Type Effects") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Post-hoc Carbohydrate Comparisons

Following the ANOVA, pairwise t-tests were performed to compare each carbohydrate type to the 'no carbohydrate' control. The results are shown below.

```{r carb-posthoc-table}
knitr::kable(carb_posthoc, digits = 4, 
             caption = "Pairwise Comparisons vs No Carbohydrate Control") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Three-way Interaction Analysis

To assess the combined effects of group, carbohydrate type, and time, a three-way ANOVA was conducted. The results are summarized in this table.

```{r interaction-stats-table}
# Check the structure and convert to data frame for proper column selection
interaction_display <- as.data.frame(interaction_stats) %>%
  select(analyte, Effect, p, p.adj, p.adj.signif) %>%
  rename(Analyte = analyte, `P-value` = p, `Adjusted P-value` = p.adj, 
         Significance = p.adj.signif)

knitr::kable(interaction_display, 
             digits = 4, 
             caption = "Three-way ANOVA: Group × Carbohydrate × Time Interactions") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Subject-Level Analyses

To account for individual variability, we conducted analyses at the subject level. This allows us to examine within-subject changes and summarize statistics for each participant, providing a more granular view of the data.

### Subject-Level Summary Statistics

This table provides summary statistics for each subject, including the mean concentration and number of observations.

```{r subject-summary-table}
knitr::kable(subject_summary, digits = 3, 
             caption = "Subject-Level Summary Statistics") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Within-Subject Changes (0h to 48h)

This table shows the results of statistical tests on the changes in SCFA concentrations within each subject from baseline to 48 hours.

```{r within-subject-stats-table}
knitr::kable(within_subject_stats, digits = 4, 
             caption = "Within-Subject Changes from Baseline to 48h") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Case-Only Temporal Analysis

To isolate the effects of the intervention within the case group, we performed a temporal analysis comparing SCFA concentrations at 0h and 48h. This analysis helps to understand the direct impact of the carbohydrate types on the case subjects over time.

### Case Group Temporal Changes by Carbohydrate Type

This table presents the temporal changes in SCFA concentrations for the case group, broken down by carbohydrate type.

```{r case-only-stats-table}
knitr::kable(case_only_stats, digits = 4, 
             caption = "Case Group Only: Temporal Changes (0h to 48h) by Carbohydrate Type") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Case Group Temporal Changes (Pooled)

Here, we present the temporal changes for the case group, pooled across all carbohydrate types to assess the overall time effect.

```{r case-only-pooled-stats-table}
knitr::kable(case_only_pooled_stats, digits = 4, 
             caption = "Case Group Only: Temporal Changes (0h to 48h) Pooled Across Carbohydrate Types") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Case Group Mixed-Effects Models (Subject Random Effects)

This table summarizes the results from the mixed-effects models applied to the case group data, accounting for subject-specific random effects.

```{r case-only-mixed-effects-summary}
# Display key results from case-only mixed-effects models
case_only_mixed_summary <- data.frame(
  analyte = character(),
  effect = character(),
  f_value = numeric(),
  p_value = numeric(),
  stringsAsFactors = FALSE
)

for (analyte_name in names(case_only_mixed_effects)) {
  anova_results <- case_only_mixed_effects[[analyte_name]]$anova_time_carb
  for (i in 1:nrow(anova_results)) {
    case_only_mixed_summary <- rbind(case_only_mixed_summary, data.frame(
      analyte = analyte_name,
      effect = rownames(anova_results)[i],
      f_value = anova_results[i, "F value"],
      p_value = anova_results[i, "Pr(>F)"],
      stringsAsFactors = FALSE
    ))
  }
}

# Add significance indicators
case_only_mixed_summary <- case_only_mixed_summary %>%
  mutate(significance = case_when(
    p_value < 0.001 ~ "***",
    p_value < 0.01 ~ "**", 
    p_value < 0.05 ~ "*",
    TRUE ~ "ns"
  )) %>%
  rename(Analyte = analyte, Effect = effect, `F-value` = f_value, `P-value` = p_value, 
         Significance = significance)

knitr::kable(case_only_mixed_summary, digits = 4, 
             caption = "Case Group Mixed-Effects Models: Time × Carbohydrate Effects with Subject Random Effects") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Delta Change Analysis (48h vs 0h)

To further investigate the magnitude of change over time, we calculated the delta (change) in concentration for each analyte between 48h and 0h. This approach focuses on the *response magnitude* and allows us to test whether the group or carbohydrate type influences how strongly subjects respond to the intervention over time.

```{r delta-analysis}
# Calculate delta values for all subjects
delta_analysis <- sample_data_long %>%
  filter(timepoint_hr %in% c("0", "48")) %>%
  mutate(timepoint_hr = as.character(timepoint_hr)) %>%
  pivot_wider(names_from = timepoint_hr, 
              values_from = concentration, 
              names_prefix = "time_") %>%
  mutate(delta_48h_0h = time_48 - time_0) %>%
  filter(!is.na(delta_48h_0h))

# Statistical comparisons of delta values between groups
delta_group_stats <- delta_analysis %>%
  group_by(analyte) %>%
  t_test(delta_48h_0h ~ group) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance()

# Statistical comparisons of delta values between carbohydrate types
delta_carb_stats <- delta_analysis %>%
  group_by(analyte) %>%
  anova_test(delta_48h_0h ~ carbohydrate_type) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance()

# Post-hoc comparisons for carbohydrate effects on delta
delta_carb_posthoc <- delta_analysis %>%
  group_by(analyte) %>%
  pairwise_t_test(delta_48h_0h ~ carbohydrate_type, 
                  ref.group = "no_carbohydrate") %>%
  adjust_pvalue(method = "BH") %>%
  add_significance()

# Two-way ANOVA for delta: Group × Carbohydrate
delta_interaction_stats <- delta_analysis %>%
  group_by(analyte) %>%
  anova_test(delta_48h_0h ~ group * carbohydrate_type) %>%
  adjust_pvalue(method = "BH") %>%
  add_significance()

# Mixed-effects models for delta values
delta_mixed_effects <- list()

for (analyte_name in scfa_analytes) {
  delta_analyte_data <- delta_analysis %>% 
    filter(analyte == analyte_name) %>%
    mutate(
      group = factor(group, levels = c("control", "case")),
      carbohydrate_type = factor(carbohydrate_type, 
                                levels = c("no_carbohydrate", "rapid_digestible", "slow_digestible")),
      subject = factor(subject)
    )
  
  full_model <- lmer(delta_48h_0h ~ group * carbohydrate_type + (1 | subject), 
                     data = delta_analyte_data, REML = FALSE)
  
  delta_mixed_effects[[analyte_name]] <- list(
    full_model = full_model,
    anova_full = anova(full_model)
  )
}

# Summary statistics for delta values
delta_summary <- delta_analysis %>%
  group_by(group, carbohydrate_type, analyte) %>%
  summarise(
    n = n(),
    mean_delta = mean(delta_48h_0h, na.rm = TRUE),
    sd_delta = sd(delta_48h_0h, na.rm = TRUE),
    sem_delta = sd_delta / sqrt(n),
    .groups = "drop"
  ) %>%
  rename(Group = group, `Carbohydrate Type` = carbohydrate_type, Analyte = analyte,
         `Mean Delta` = mean_delta, `SD Delta` = sd_delta, `SEM Delta` = sem_delta)

# Save delta analysis results
write.csv(delta_summary, "results/delta_summary_statistics.csv", row.names = FALSE)
write.csv(delta_group_stats, "results/delta_group_comparisons.csv", row.names = FALSE)
write.csv(delta_carb_stats, "results/delta_carbohydrate_effects.csv", row.names = FALSE)
write.csv(delta_carb_posthoc, "results/delta_carbohydrate_posthoc.csv", row.names = FALSE)
```

### Delta Summary Statistics

This table provides summary statistics for the calculated delta values (48h - 0h), showing the mean change and variability.

```{r delta-summary-table}
knitr::kable(delta_summary, digits = 3, 
             caption = "Summary Statistics for Delta Change (48h - 0h)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Delta Group Comparisons

This table shows the results of t-tests comparing the delta values between the control and case groups.

```{r delta-group-stats-table}
knitr::kable(delta_group_stats, digits = 4, 
             caption = "Group Comparisons of Delta Change (Response Magnitude)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Delta Carbohydrate Comparisons

This table presents the results of ANOVA tests on the delta values to examine the effect of carbohydrate type on the magnitude of change.

```{r delta-carb-stats-table}
knitr::kable(delta_carb_stats, digits = 4, 
             caption = "ANOVA Results for Carbohydrate Effects on Delta Change") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Delta Carbohydrate Post-Hoc Comparisons

Following the ANOVA on delta values, pairwise t-tests were performed to compare each carbohydrate type to the 'no carbohydrate' control. The results are shown below.

```{r delta-carb-posthoc-table}
knitr::kable(delta_carb_posthoc, digits = 4, 
             caption = "Pairwise Comparisons of Delta Change vs No Carbohydrate") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Delta Interaction Analysis

To assess the combined effects of group and carbohydrate type on the delta values, a two-way ANOVA was conducted. The results are summarized in this table.

```{r delta-interaction-stats-table}
delta_interaction_display <- as.data.frame(delta_interaction_stats) %>%
  select(analyte, Effect, p, p.adj, p.adj.signif) %>%
  rename(Analyte = analyte, `P-value` = p, `Adjusted P-value` = p.adj, Significance = p.adj.signif)
knitr::kable(delta_interaction_display, digits = 4, 
             caption = "Two-way ANOVA on Delta Change: Group × Carbohydrate Interactions") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

### Delta Mixed-Effects Models

This table summarizes the results from the mixed-effects models applied to the delta values, accounting for subject-specific random effects.

```{r delta-mixed-effects-summary}
# Display key results from delta mixed-effects models
delta_mixed_summary <- data.frame(
  analyte = character(),
  effect = character(),
  f_value = numeric(),
  p_value = numeric(),
  stringsAsFactors = FALSE
)

for (analyte_name in names(delta_mixed_effects)) {
  anova_results <- delta_mixed_effects[[analyte_name]]$anova_full
  for (i in 1:nrow(anova_results)) {
    delta_mixed_summary <- rbind(delta_mixed_summary, data.frame(
      analyte = analyte_name,
      effect = rownames(anova_results)[i],
      f_value = anova_results[i, "F value"],
      p_value = anova_results[i, "Pr(>F)"],
      stringsAsFactors = FALSE
    ))
  }
}

delta_mixed_summary <- delta_mixed_summary %>%
  mutate(significance = case_when(
    p_value < 0.001 ~ "***",
    p_value < 0.01 ~ "**", 
    p_value < 0.05 ~ "*",
    TRUE ~ "ns"
  )) %>%
  rename(Analyte = analyte, Effect = effect, `F-value` = f_value, `P-value` = p_value, 
         Significance = significance)

knitr::kable(delta_mixed_summary, digits = 4, 
             caption = "Delta Change Mixed-Effects Models: Group × Carbohydrate Effects") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Mixed-Effects Model Results

To account for the repeated measures design and the variability between subjects, we utilized linear mixed-effects models. These models include subject as a random effect, allowing us to more accurately assess the fixed effects of group, carbohydrate type, and time.

### Mixed-Effects Model Summary

This table presents a summary of the full mixed-effects models, including F-values and p-values for all fixed effects.

```{r mixed-effects-summary}
# Display key results from mixed-effects models
mixed_effects_summary <- data.frame(
  analyte = character(),
  effect = character(),
  f_value = numeric(),
  p_value = numeric(),
  stringsAsFactors = FALSE
)

for (analyte_name in names(mixed_effects_results)) {
  anova_results <- mixed_effects_results[[analyte_name]]$anova_full
  for (i in 1:nrow(anova_results)) {
    mixed_effects_summary <- rbind(mixed_effects_summary, data.frame(
      analyte = analyte_name,
      effect = rownames(anova_results)[i],
      f_value = anova_results[i, "F value"],
      p_value = anova_results[i, "Pr(>F)"],
      stringsAsFactors = FALSE
    ))
  }
}

# Add significance indicators
mixed_effects_summary <- mixed_effects_summary %>%
  mutate(significance = case_when(
    p_value < 0.001 ~ "***",
    p_value < 0.01 ~ "**", 
    p_value < 0.05 ~ "*",
    TRUE ~ "ns"
  )) %>%
  rename(Analyte = analyte, Effect = effect, `F-value` = f_value, `P-value` = p_value, 
         Significance = significance)

knitr::kable(mixed_effects_summary, digits = 4, 
             caption = "Mixed-Effects Models: F-values and P-values for Fixed Effects") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

# Visualizations

To visually explore the data, we generated a series of plots. These visualizations illustrate the relationships between SCFA concentrations and the experimental variables, including group, carbohydrate type, and time. Each plot is designed to highlight different aspects of the data, from overall trends to individual subject responses.

```{r create-plots-directory, include=FALSE}
# Create plots directory if it doesn't exist
dir.create("plots", showWarnings = FALSE)

# Define publication-quality theme
pub_theme <- theme_classic() +
  theme(
    text = element_text(size = 12, family = "sans"),
    axis.title = element_text(size = 14, face = "bold"),
    axis.text = element_text(size = 12),
    strip.text = element_text(size = 12, face = "bold"),
    legend.title = element_text(size = 12, face = "bold"),
    legend.text = element_text(size = 11),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

# Custom color palette
group_colors <- c("Control" = "#3498DB", "Case" = "#E74C3C")
carb_colors <- c("No Carbohydrate" = "#95A5A6", 
                 "Rapid Digestible" = "#F39C12", 
                 "Slow Digestible" = "#27AE60")
```

## SCFA Concentrations by Group and Carbohydrate Type

```{r plot-by-group, fig.height=10}
plot_by_group <- sample_data_long %>%
  ggplot(aes(x = group_label, y = concentration, fill = group_label)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA, position = position_dodge(width = 0.75)) +
  geom_jitter(alpha = 0.4, width = 0.2, size = 1.5) +
  facet_grid(carbohydrate_type_label ~ analyte, scales = "free_y") +
  #facet_wrap(carbohydrate_type_label ~ analyte, scales = "free_y") +
  scale_fill_manual(values = group_colors, 
                    labels = c("Control", "Case")) +
  stat_compare_means(method = "wilcox.test", 
                     comparisons = list(c("Control", "Case")),
                     label = "p.signif",
                     step_increase = 0.1) +
  labs(title = "SCFA Concentrations by Group and Carbohydrate Type",
       x = "Group",
       y = "Concentration (μM)",
       fill = "Group") +
  pub_theme +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

plot_by_group
```

## SCFA Concentrations by Carbohydrate Type and Time Point

```{r plot-by-carb, fig.height=8}
plot_by_carb <- sample_data_long %>%
  ggplot(aes(x = carbohydrate_type_label, y = concentration, fill = carbohydrate_type_label)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA, position = position_dodge(width = 0.75)) +
  geom_jitter(alpha = 0.4, width = 0.2, size = 1.5) + 
  facet_grid(timepoint_hr ~ analyte, scales = "free_y", 
             labeller = labeller(timepoint_hr = function(x) paste0(x, "h"))) +
  scale_fill_manual(values = carb_colors,
                    labels = c("No Carbohydrate", "Rapid Digestible", "Slow Digestible")) +
  stat_compare_means(method = "wilcox.test",
                     ref.group = "No Carbohydrate",
                     label = "p.signif",
                     step_increase = 0.1) +
  labs(title = "SCFA Concentrations by Carbohydrate Type and Time Point",
       x = "Carbohydrate Type",
       y = "Concentration (μM)",
       fill = "Carbohydrate Type") +
  pub_theme +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

plot_by_carb
```

## Time Series Analysis

```{r plot-time-series}
plot_time_series <- sample_data_long %>%
  mutate(timepoint_hr = as.numeric(as.character(timepoint_hr))) %>%
  group_by(carbohydrate_type_label, timepoint_hr, analyte) %>%
  summarise(
    mean_conc = mean(concentration, na.rm = TRUE),
    sem = sd(concentration, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = timepoint_hr, y = mean_conc, color = carbohydrate_type_label)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = mean_conc - sem, ymax = mean_conc + sem), 
                width = 1, linewidth = 0.8) +
  facet_wrap(~ analyte, scales = "free_y") +
  scale_color_manual(values = carb_colors,
                     labels = c("No Carbohydrate", "Rapid Digestible", "Slow Digestible")) +
  scale_x_continuous(breaks = c(0, 48)) +
  labs(title = "SCFA Concentrations Over Time by Carbohydrate Type",
       x = "Time (hours)",
       y = "Mean Concentration ± SEM (μM)",
       color = "Carbohydrate Type") +
  pub_theme +
  theme(legend.position = "bottom")

plot_time_series
```

## Concentration Heatmap

```{r plot-heatmap}
heatmap_data <- sample_data_long %>%
  mutate(timepoint_hr = paste0(timepoint_hr, "h")) %>%
  group_by(group_label, carbohydrate_type_label, timepoint_hr, analyte) %>%
  summarise(mean_conc = mean(concentration, na.rm = TRUE), .groups = "drop") %>%
  unite("condition", group_label, carbohydrate_type_label, timepoint_hr, sep = "_")

plot_heatmap <- heatmap_data %>%
  ggplot(aes(x = condition, y = analyte, fill = mean_conc)) +
  geom_tile(color = "white", linewidth = 0.5) +
  scale_fill_viridis_c(name = "Mean\nConcentration\n(μM)", option = "plasma") +
  labs(title = "SCFA Concentration Heatmap Across All Conditions",
       x = "Condition (Group_Carbohydrate_Time)",
       y = "SCFA Analyte") +
  pub_theme +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        axis.text.y = element_text(face = "italic"))

plot_heatmap
```

## Interaction Effects

```{r plot-interaction}
plot_interaction <- sample_data_long %>%
  mutate(
    timepoint_hr = as.numeric(as.character(timepoint_hr)),
    group_label = recode(group, "control" = "Control", "case" = "Case"),
    carbohydrate_type_label = recode(carbohydrate_type,
                                     "no_carbohydrate" = "No Carbohydrate",
                                     "rapid_digestible" = "Rapid Digestible",
                                     "slow_digestible" = "Slow Digestible")
  ) %>%
  group_by(group_label, carbohydrate_type_label, timepoint_hr, analyte) %>%
  summarise(mean_conc = mean(concentration, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = timepoint_hr, y = mean_conc, 
             color = carbohydrate_type_label, linetype = group_label)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3, aes(shape = group_label)) +
  facet_wrap(~ analyte, scales = "free_y") +
  scale_color_manual(
    values = carb_colors,
    breaks = c("No Carbohydrate", "Rapid Digestible", "Slow Digestible"),
    labels = c("No Carbohydrate", "Rapid Digestible", "Slow Digestible")
  ) +
  scale_x_continuous(breaks = c(0, 48)) +
  scale_linetype_manual(values = c("Control" = "solid", "Case" = "dashed")) +
  scale_shape_manual(values = c("Control" = 16, "Case" = 17)) +
  labs(title = "SCFA Concentrations: Group × Carbohydrate × Time Interaction",
       x = "Time (hours)",
       y = "Mean Concentration (μM)",
       color = "Carbohydrate Type",
       linetype = "Group",
       shape = "Group") +
  pub_theme +
  theme(legend.position = "bottom")

plot_interaction
```

## Subject-Level Individual Response Heatmap

```{r plot-subject-heatmap, fig.height=12, fig.width=16}
# Subject-level heatmap showing individual responses
subject_heatmap_data <- sample_data_long %>%
  mutate(
    condition_time = paste0(carbohydrate_type, "_", timepoint_hr, "h"),
    mean_conc = concentration  # Already averaged technical replicates
  ) %>%
  arrange(group, subject, analyte)

# Create ordered subject labels with control group first, then case group
subject_order <- subject_heatmap_data %>%
  select(subject, group) %>%
  distinct() %>%
  arrange(desc(group), subject) %>%  # control comes before case alphabetically
  mutate(
    subject_group = paste0(subject, " (", group, ")"),
    # Add spacing indicator for plotting
    group_spacing = ifelse(group == "control", "Control Group", "Case Group")
  )

# Create subject ordering with gap between groups
control_subjects <- subject_order %>% filter(group == "control") %>% arrange(subject)
case_subjects <- subject_order %>% filter(group == "case") %>% arrange(subject)

# Create spacer rows for the gap between groups
n_analytes <- length(unique(subject_heatmap_data$analyte))
n_conditions <- length(unique(subject_heatmap_data$condition_time))

# Create empty spacer data for gap
spacer_data <- expand_grid(
  analyte = unique(subject_heatmap_data$analyte),
  condition_time = unique(subject_heatmap_data$condition_time),
  subject_group = " ",
  mean_conc = NA_real_
)

# Create ordered factor levels with gap
all_subject_levels <- c(
  rev(control_subjects$subject_group),  # Control at top (reversed for ggplot)
  " ",           # Gap
  rev(case_subjects$subject_group)      # Case at bottom (reversed for ggplot)
)

# Add the ordered subject labels to the data and include spacer
subject_heatmap_data <- subject_heatmap_data %>%
  left_join(subject_order %>% select(subject, subject_group, group_spacing), by = "subject") %>%
  bind_rows(spacer_data) %>%
  mutate(
    subject_group = factor(subject_group, levels = all_subject_levels)
  )

plot_subject_heatmap <- subject_heatmap_data %>%
  ggplot(aes(x = condition_time, y = subject_group, fill = mean_conc)) +
  geom_tile(color = "white", linewidth = 0.2) +
  facet_wrap(~ analyte, scales = "free", ncol = 2) +
  scale_fill_viridis_c(name = "Concentration\n(μM)", option = "plasma", 
                       trans = "sqrt", na.value = "white") +
  labs(title = "Individual Subject SCFA Responses Across All Conditions",
       subtitle = "Control group (top) and Case group (bottom) with visual separation",
       x = "Condition × Time Point",
       y = "Subject (Group)") +
  pub_theme +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    axis.text.y = element_text(size = 7),
    strip.text = element_text(size = 10, face = "bold"),
    panel.spacing = unit(0.5, "lines")
  )

plot_subject_heatmap
```

## Individual Subject Trajectories by Carbohydrate Source

```{r plot-trajectories, fig.height=12, fig.width=16}
# Prepare data for trajectory plots
trajectory_data <- sample_data_long %>%
  mutate(
    timepoint_hr = as.numeric(as.character(timepoint_hr)),
    mean_conc = concentration,  # Already averaged technical replicates
    group_label = recode(group, "control" = "Control", "case" = "Case")
  )

# Calculate group means for overlay
group_means_trajectories <- trajectory_data %>%
  group_by(group_label, carbohydrate_type, timepoint_hr, analyte) %>%
  summarise(
    mean_conc = mean(mean_conc, na.rm = TRUE),
    sem = sd(mean_conc, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )

# Create trajectory plots by carbohydrate source
plot_trajectories <- trajectory_data %>%
  ggplot(aes(x = timepoint_hr, y = mean_conc)) +
  # Individual subject lines (thin, semi-transparent)
  geom_line(aes(group = subject, color = group_label), 
            alpha = 0.4, linewidth = 0.5) +
  geom_point(aes(color = group_label), alpha = 0.5, size = 1) +
  # Group mean lines (thick, prominent)
  geom_line(data = group_means_trajectories, 
            aes(color = group_label), 
            linewidth = 2, alpha = 0.9) +
  geom_point(data = group_means_trajectories, 
             aes(color = group_label), 
             size = 3, alpha = 0.9) +
  # Error bars for group means
  geom_errorbar(data = group_means_trajectories,
                aes(ymin = mean_conc - sem, ymax = mean_conc + sem, color = group_label),
                width = 1, linewidth = 1, alpha = 0.7) +
  facet_grid(carbohydrate_type ~ analyte, scales = "free_y",
             labeller = labeller(carbohydrate_type = function(x) {
               str_replace_all(str_to_title(str_replace_all(x, "_", " ")), 
                              c("No" = "No", "Rapid" = "Rapid", "Slow" = "Slow"))
             })) +
  scale_color_manual(values = group_colors) +
  scale_x_continuous(breaks = c(0, 48)) +
  labs(title = "Individual Subject SCFA Trajectories by Carbohydrate Source",
       subtitle = "Thin lines: individual subjects, Thick lines: group means ± SEM",
       x = "Time (hours)",
       y = "Concentration (μM)",
       color = "Group") +
  pub_theme +
  theme(
    legend.position = "bottom",
    strip.text = element_text(size = 10, face = "bold"),
    panel.spacing = unit(0.3, "lines")
  )

plot_trajectories
```

## Case Group Only: Temporal Changes

```{r plot-case-only, fig.height=8, fig.width=12}
# Case-only temporal changes visualization
case_only_plot_data <- sample_data_long %>%
  filter(group == "case") %>%
  mutate(
    timepoint_hr = as.numeric(as.character(timepoint_hr)),
    carbohydrate_type_label = recode(carbohydrate_type,
      "no_carbohydrate" = "No Carbohydrate",
      "rapid_digestible" = "Rapid Digestible",
      "slow_digestible" = "Slow Digestible"
    )
  ) %>%
  group_by(carbohydrate_type_label, timepoint_hr, analyte) %>%
  summarise(
    mean_conc = mean(concentration, na.rm = TRUE),
    sem = sd(concentration, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )

plot_case_only <- case_only_plot_data %>%
  ggplot(aes(x = timepoint_hr, y = mean_conc, color = carbohydrate_type_label)) +
  geom_line(linewidth = 1.5) +
  geom_point(size = 4) +
  geom_errorbar(aes(ymin = mean_conc - sem, ymax = mean_conc + sem), 
                width = 1, linewidth = 1) +
  facet_wrap(~ analyte, scales = "free_y") +
  scale_color_manual(values = carb_colors) +
  scale_x_continuous(breaks = c(0, 48)) +
  labs(title = "Case Group Only: SCFA Temporal Changes by Carbohydrate Type",
       subtitle = "Mean ± SEM concentrations from 0h to 48h",
       x = "Time (hours)",
       y = "Mean Concentration ± SEM (μM)",
       color = "Carbohydrate Type") +
  pub_theme +
  theme(legend.position = "bottom")

plot_case_only
```

## Case Group Individual Subject Trajectories

```{r plot-case-individual, fig.height=12, fig.width=16}
# Individual case subject trajectories with statistical overlay
case_individual_data <- sample_data_long %>%
  filter(group == "case") %>%
  mutate(
    timepoint_hr = as.numeric(as.character(timepoint_hr)),
    mean_conc = concentration  # Already averaged technical replicates
  )

plot_case_individual <- case_individual_data %>%
  ggplot(aes(x = timepoint_hr, y = mean_conc)) +
  # Individual subject lines
  geom_line(aes(group = subject), alpha = 0.6, linewidth = 0.8, color = "#E74C3C") +
  geom_point(alpha = 0.6, size = 2, color = "#E74C3C") +
  # Group mean overlay
  geom_line(data = case_only_plot_data, 
            aes(color = carbohydrate_type_label), 
            linewidth = 2, alpha = 0.9) +
  geom_point(data = case_only_plot_data, 
             aes(color = carbohydrate_type_label), 
             size = 4, alpha = 0.9) +
  facet_grid(carbohydrate_type_label ~ analyte, scales = "free_y") +
  scale_color_manual(values = carb_colors) +
  scale_x_continuous(breaks = c(0, 48)) +
  labs(title = "Case Group Individual Subject SCFA Trajectories",
       subtitle = "Thin lines: individual subjects, Thick lines: group means",
       x = "Time (hours)",
       y = "Concentration (μM)",
       color = "Carbohydrate Type") +
  pub_theme +
  theme(
    legend.position = "bottom",
    strip.text = element_text(size = 10, face = "bold"),
    panel.spacing = unit(0.3, "lines")
  )

plot_case_individual
```

## Delta Change (48h-0h) Visualizations

```{r plot-delta-changes, fig.height=8, fig.width=12}
# Group comparison of response magnitudes
plot_delta_group <- delta_analysis %>%
  mutate(
    group_label = recode(group, "control" = "Control", "case" = "Case")
  ) %>%
  ggplot(aes(x = group_label, y = delta_48h_0h, fill = group_label)) +
  geom_boxplot(alpha = 0.8) +
  facet_wrap(~ analyte, scales = "free_y") +
  scale_fill_manual(values = group_colors) +
  stat_compare_means(method = "wilcox.test", 
                     comparisons = list(c("control", "case")),
                     label = "p.signif",
                     step_increase = 0.1) +
  labs(title = "SCFA Response Magnitude (Δ48h-0h) by Group",
       subtitle = "Comparing metabolic response between control and case groups",
       x = "Group",
       y = "Delta Concentration (48h - 0h) μM",
       fill = "Group") +
  pub_theme +
  theme(legend.position = "bottom")

plot_delta_group
```

```{r plot-delta-carb-effects, fig.height=8, fig.width=12}
# Carbohydrate comparison of response magnitudes
plot_delta_carb <- delta_analysis %>%
  mutate(
    carbohydrate_type_label = recode(carbohydrate_type,
      "no_carbohydrate" = "No Carbohydrate",
      "rapid_digestible" = "Rapid Digestible",
      "slow_digestible" = "Slow Digestible"
    )
  ) %>%
  ggplot(aes(x = carbohydrate_type_label, y = delta_48h_0h, fill = carbohydrate_type_label)) +
  geom_boxplot(alpha = 0.8) +
  facet_wrap(~ analyte, scales = "free_y") +
  scale_fill_manual(values = carb_colors) +
  stat_compare_means(method = "wilcox.test",
                     ref.group = "no_carbohydrate",
                     label = "p.signif",
                     step_increase = 0.1) +
  labs(title = "SCFA Response Magnitude (Δ48h-0h) by Carbohydrate Type",
       subtitle = "Comparing metabolic response magnitude across carbohydrate interventions",
       x = "Carbohydrate Type",
       y = "Delta Concentration (48h - 0h) μM",
       fill = "Carbohydrate Type") +
  pub_theme +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

plot_delta_carb
```

```{r plot-delta-interaction, fig.height=10, fig.width=14}
# Group × Carbohydrate interaction for delta
plot_delta_interaction <- delta_analysis %>%
  mutate(
    group_label = recode(group, "control" = "Control", "case" = "Case"),
    carbohydrate_type_label = recode(carbohydrate_type,
      "no_carbohydrate" = "No Carbohydrate",
      "rapid_digestible" = "Rapid Digestible",
      "slow_digestible" = "Slow Digestible"
    )
  ) %>%
  group_by(group_label, carbohydrate_type_label, analyte) %>%
  summarise(
    mean_delta = mean(delta_48h_0h, na.rm = TRUE),
    sem_delta = sd(delta_48h_0h, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = carbohydrate_type_label, y = mean_delta, fill = group_label)) +
  geom_col(position = "dodge", alpha = 0.8) +
  geom_errorbar(aes(ymin = mean_delta - sem_delta, ymax = mean_delta + sem_delta),
                position = position_dodge(width = 0.9), width = 0.2) +
  facet_wrap(~ analyte, scales = "free_y") +
  scale_fill_manual(values = group_colors) +
  labs(title = "SCFA Response Magnitude: Group × Carbohydrate Interaction",
       subtitle = "Mean ± SEM change from baseline (48h - 0h)",
       x = "Carbohydrate Type",
       y = "Mean Delta Concentration ± SEM (μM)",
       fill = "Group") +
  pub_theme +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

plot_delta_interaction
```

## Save Plots

```{r save-plots}
# Save all plots to files with appropriate dimensions
ggsave("plots/scfa_by_group.png", plot_by_group, width = 14, height = 10, dpi = 300)
ggsave("plots/scfa_by_carb.png", plot_by_carb, width = 14, height = 8, dpi = 300)
ggsave("plots/scfa_time_series.png", plot_time_series, width = 12, height = 8, dpi = 300)
ggsave("plots/scfa_heatmap.png", plot_heatmap, width = 14, height = 6, dpi = 300)
ggsave("plots/scfa_interaction.png", plot_interaction, width = 14, height = 10, dpi = 300)
ggsave("plots/scfa_subject_heatmap.png", plot_subject_heatmap, width = 16, height = 12, dpi = 300)
ggsave("plots/scfa_trajectories.png", plot_trajectories, width = 16, height = 12, dpi = 300)
ggsave("plots/scfa_case_only_temporal.png", plot_case_only, width = 12, height = 8, dpi = 300)
ggsave("plots/scfa_case_individual_trajectories.png", plot_case_individual, width = 16, height = 12, dpi = 300)
ggsave("plots/scfa_delta_group_comparison.png", plot_delta_group, width = 12, height = 8, dpi = 300)
ggsave("plots/scfa_delta_carbohydrate_effects.png", plot_delta_carb, width = 12, height = 8, dpi = 300)
ggsave("plots/scfa_delta_group_carb_interaction.png", plot_delta_interaction, width = 14, height = 10, dpi = 300)

cat("All plots saved to plots/ directory with publication-quality formatting\n")
```

# Discussion

## Key Statistical Findings

### Temporal Effects Are Dominant
The most striking finding across all analyses is the **universal temporal effect** from 0h to 48h. Every SCFA analyte showed highly significant temporal changes (p < 2e-16 for all compounds), with dramatic increases from baseline to 48h:

- **Acetate**: 3.69 μM → 34.0 μM (9-fold increase)
- **Butyrate**: 0.745 μM → 7.38 μM (10-fold increase)  
- **Propionate**: 0.502 μM → 4.91 μM (10-fold increase)
- **5-aminovalerate**: 0.108 μM → 0.924 μM (8.5-fold increase)
- **Succinate**: 0.444 μM → 2.05 μM (4.6-fold increase)

### Group Differences Are Not Significant
Contrary to initial expectations, **no significant differences** were found between control and case groups for any SCFA analyte (all p > 0.05). This suggests that the experimental intervention did not create distinct SCFA metabolic signatures between groups when controlling for other factors.

### Carbohydrate-Specific Effects Are Present But Modest
Carbohydrate type showed significant effects for **acetate, butyrate, propionate, and succinate** in mixed-effects models (p < 0.05), but these effects were modest compared to temporal changes:

- **Succinate** showed the clearest carbohydrate response, with slow digestible carbohydrates producing higher concentrations than no carbohydrate (p = 0.009 in post-hoc testing)
- **Propionate and butyrate** showed significant carbohydrate × time interactions, indicating that carbohydrate type influences the temporal response pattern

### Case Group Analysis Reveals Universal Temporal Responses
The case-only mixed-effects analysis confirmed that **all SCFA analytes increase significantly over time** in case subjects (all p < 2e-16). This demonstrates that the temporal metabolic response is robust and consistent across individual subjects.

**Carbohydrate-specific findings in case subjects:**
- **Acetate**: Modest carbohydrate effect (p = 0.043)
- **Succinate**: Both temporal (p < 2e-16) and carbohydrate effects (p = 0.018), with marginal interaction (p = 0.030)
- **Propionate**: Near-significant carbohydrate effect (p = 0.082) and interaction (p = 0.058)

### Delta Change Analysis (Response Magnitude)

To complement the analysis of raw concentrations, we analyzed the delta (48h - 0h) values to focus specifically on the *magnitude* of the metabolic response. This approach helps to clarify whether the experimental factors (group, carbohydrate type) influence the *rate of change* in SCFA levels, independent of baseline concentrations.

-   **Group Effects on Response Magnitude**: The analysis of delta values revealed no significant differences in the magnitude of SCFA changes between the control and case groups. This reinforces the finding from the primary analysis that the experimental intervention did not lead to a differential metabolic response between groups.

-   **Carbohydrate Effects on Response Magnitude**: The delta analysis highlighted that carbohydrate type had a significant effect on the magnitude of the response for some analytes. This indicates that while the temporal trend is universal, the *extent* of SCFA production is influenced by the type of carbohydrate provided.

-   **Interaction Effects**: The two-way ANOVA on delta values showed no significant interaction between group and carbohydrate type for most analytes, suggesting that the effect of carbohydrate type on response magnitude was consistent across both control and case groups.

### Individual Subject Variation
Subject-level analyses revealed substantial inter-individual variation in baseline SCFA levels, particularly in the case group (higher standard deviations for most analytes). The mixed-effects models properly accounted for this variation through random effects, strengthening the temporal effect findings.

## Biological Interpretation

### Microbial Fermentation Response
The dramatic 4-10 fold increases in SCFA concentrations from 0h to 48h likely represent **active microbial fermentation** of dietary carbohydrates in the gut. This temporal pattern suggests:

1. **Lag phase** (0h): Minimal baseline SCFA production
2. **Active fermentation** (48h): Peak metabolic activity producing substantial SCFA concentrations

### Metabolic Pathway Specificity
The differential responses among SCFA analytes suggest distinct fermentation pathways:

- **Acetate, butyrate, and propionate** (primary SCFAs) showed the most dramatic increases, consistent with their role as major fermentation end-products
- **5-aminovalerate** showed significant but more modest increases, reflecting its secondary metabolite status
- **Succinate** showed the smallest response, consistent with its role as an intermediate rather than end-product

### Limited Treatment Differentiation
The absence of group differences suggests that the experimental intervention may not have sufficiently altered gut microbiome composition or metabolic function to create detectable SCFA signature differences within the 48-hour timeframe studied.

# Conclusions

This comprehensive SCFA analysis using PFBBr derivatization and GC-MS quantification reveals several key findings:

## Primary Findings

1. **Universal Temporal Response**: All five SCFA analytes showed dramatic 4-10 fold increases from baseline (0h) to 48 hours, indicating robust gut microbial fermentation responses regardless of treatment group.

2. **No Treatment Group Differentiation**: Despite expectations, no significant differences were observed between control and case groups for any SCFA analyte, suggesting the experimental intervention did not create distinct metabolic signatures within the study timeframe.

3. **Modest Carbohydrate-Specific Effects**: While carbohydrate type influenced SCFA production (particularly succinate and propionate), these effects were secondary to the dominant temporal response pattern.

4. **Robust Case Group Responses**: Case-only analysis confirmed universal temporal increases across all SCFA analytes, with some analytes showing additional carbohydrate-dependent response patterns.

5. **Delta Analysis Confirms Findings**: The analysis of delta changes (48h - 0h) reinforced the primary findings, showing no significant group differences in the magnitude of the metabolic response but confirming that carbohydrate type does influence the extent of SCFA production.

6. **Substantial Individual Variation**: Subject-level analyses revealed considerable inter-individual differences in SCFA production, properly accounted for through mixed-effects modeling.

## Statistical Rigor

The analysis employed multiple complementary statistical approaches:
- Mixed-effects models controlling for subject random effects
- Multiple testing corrections (Benjamini-Hochberg)
- Paired analyses for repeated measures design
- Case-specific temporal analysis with proper statistical controls

## Clinical Implications

These findings suggest that:
- **SCFA production responses are universal** across subjects regardless of treatment group
- **Carbohydrate fermentation is a dominant metabolic process** that may overshadow treatment-specific effects
- **Individual metabolic variation** is substantial and should be considered in future study designs
- **Longer observation periods** may be needed to detect treatment-specific metabolic signatures

## Study Limitations

- The 48-hour timeframe may be insufficient to detect treatment-specific microbiome changes
- Sample size may limit power to detect subtle group differences
- The dramatic temporal effects may mask smaller but clinically relevant group differences

This analysis provides a robust foundation for understanding gut microbiome SCFA production patterns and demonstrates the importance of temporal dynamics in metabolomic studies.

# References

1. Haak, B. W., Littmann, E. R., Chaubard, J.-L., Pickard, A. J., Fontana, E., Adhi, F., et al. (2018). Impact of gut colonization with butyrate-producing microbiota on respiratory viral infection following allo-HCT. *Blood*, 131(26), 2978–2986.

2. Wang, Y., Chen, J., Song, Y. H., Zhao, R., Xia, W., Yang, Y. Q., et al. (2022). Effects of slowly digestible carbohydrate on glucose homeostasis in diabetes: A systematic review and meta-analysis. *Frontiers in Nutrition*, 9, 854725. https://doi.org/10.3389/fnut.2022.854725

3. DFI-HMMF Targeted Metabolomics: General and Detailed Methods. University of Chicago Medicine, Duchossois Family Institute.